<!DOCTYPE html>
<html lang="vi" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#f8b4d9" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#2a0f1f" media="(prefers-color-scheme: dark)">
  <meta name="msapplication-TileColor" content="#f8b4d9">

  <title>G·ª≠i t·∫∑ng B√≠ch Hi·ªÅn üêºüíõ</title>
  
  <!-- Preload critical resources -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="images/PandaFox-static.jpg" as="image">
  <link rel="preload" href="images/memory2.png" as="image">
  <link rel="preload" href="images/memory3.png" as="image">
  <link rel="preload" href="images/memory4.png" as="image">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=6.4.0" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Poppins:wght@400;500&display=swap" rel="stylesheet" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Style+Script&display=swap" rel="stylesheet" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js?v=1.5.1" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="styles.css?v=1.0.0">
</head>

<body>
  <!-- Skip to main content for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Lock Screen -->
  <div class="lock-screen" id="lockScreen">
    <div class="lock-container">
      <div class="lock-simple" id="lockHeart">
        <div class="lock-body" id="lockBody"></div>
        <div class="lock-hole"></div>
        <div class="lock-notch" id="lockNotch"></div>
      </div>
      
      <div class="lock-body">
        <h2>Enter the passcode</h2>
        <div class="code-display" id="codeDisplay">
          <div class="code-digit" id="digit1">-</div>
          <div class="code-digit" id="digit2">-</div>
          <div class="code-digit" id="digit3">-</div>
          <div class="code-digit" id="digit4">-</div>
        </div>
        
        <div class="lock-buttons">
          <button class="lock-btn" data-number="1" title="S·ªë 1" aria-label="S·ªë 1">1</button>
          <button class="lock-btn" data-number="2" title="S·ªë 2" aria-label="S·ªë 2">2</button>
          <button class="lock-btn" data-number="3" title="S·ªë 3" aria-label="S·ªë 3">3</button>
          <button class="lock-btn" data-number="4" title="S·ªë 4" aria-label="S·ªë 4">4</button>
          <button class="lock-btn" data-number="5" title="S·ªë 5" aria-label="S·ªë 5">5</button>
          <button class="lock-btn" data-number="6" title="S·ªë 6" aria-label="S·ªë 6">6</button>
          <button class="lock-btn" data-number="7" title="S·ªë 7" aria-label="S·ªë 7">7</button>
          <button class="lock-btn" data-number="8" title="S·ªë 8" aria-label="S·ªë 8">8</button>
          <button class="lock-btn" data-number="9" title="S·ªë 9" aria-label="S·ªë 9">9</button>
          <button class="lock-btn" id="clearBtn" title="X√≥a t·∫•t c·∫£" aria-label="X√≥a t·∫•t c·∫£"><i class="fas fa-undo"></i></button>
          <button class="lock-btn" data-number="0" title="S·ªë 0" aria-label="S·ªë 0">0</button>
          <button class="lock-btn" id="deleteBtn" title="X√≥a k√Ω t·ª± cu·ªëi" aria-label="X√≥a k√Ω t·ª± cu·ªëi"><i class="fas fa-backspace"></i></button>
          
          <button class="submit-code" id="submitCode" title="M·ªü kh√≥a" aria-label="M·ªü kh√≥a">Unlock <i class="fas fa-heart"></i></button>
        </div>
      </div>
    </div>
    
    <div class="stars" id="stars"></div>
  </div>

  <!-- Controls -->
  <div class="controls">
  </div>
  
  <!-- Music Player v·ªõi thi·∫øt k·∫ø m·ªõi -->
  <div class="music-player" id="musicPlayer">
    <div class="now-playing" id="nowPlaying"><span>Ch∆∞a ch·ªçn b√†i h√°t</span></div>
    <div class="song-artist" id="songArtist"><span></span></div>
    
    <div class="player-controls">
      <button class="music-btn" id="prevBtn" title="B√†i tr∆∞·ªõc" aria-label="B√†i tr∆∞·ªõc">
        <i class="fas fa-step-backward"></i>
      </button>
      <button class="music-btn" id="playPauseBtn" title="Ph√°t/T·∫°m d·ª´ng" aria-label="Ph√°t/T·∫°m d·ª´ng">
        <i class="fas fa-play"></i>
      </button>
      <button class="music-btn" id="nextBtn" title="B√†i ti·∫øp" aria-label="B√†i ti·∫øp">
        <i class="fas fa-step-forward"></i>
      </button>
    </div>
    
    <div class="additional-controls">
      <button class="func-btn" id="replayOneBtn" title="L·∫∑p l·∫°i b√†i hi·ªán t·∫°i" aria-label="L·∫∑p l·∫°i b√†i hi·ªán t·∫°i">
        <i class="fas fa-redo"></i>
      </button>
      <button class="func-btn" id="replayAllBtn" title="L·∫∑p l·∫°i t·∫•t c·∫£" aria-label="L·∫∑p l·∫°i t·∫•t c·∫£">
        <i class="fas fa-infinity"></i>
      </button>
      <button class="func-btn" id="shuffleBtn" title="Ph√°t ng·∫´u nhi√™n" aria-label="Ph√°t ng·∫´u nhi√™n">
        <i class="fas fa-random"></i>
      </button>
    </div>
  </div>
  
  <!-- Audio Element -->
  <audio id="audioElement" playsinline role="application" aria-label="Tr√¨nh ph√°t nh·∫°c"></audio>

  <!-- Hearts effect -->
  <div class="hearts" id="hearts"></div>

  <!-- Screen 1 -->
  <div class="screen hidden" id="screen1" id="main-content">
    <h1>My one and only, my lifeline üíõüíô</h1>
          <img id="girlfriend-pic" src="images/PandaFox-static.jpg" alt="Cute Couple" data-static="images/PandaFox-static.jpg" data-animated="images/PandaFox-animated.gif" loading="eager" decoding="async" fetchpriority="high">
    <button class="heart-button" onclick="goToScreen2()" aria-label="Ti·∫øp t·ª•c">D·ª£ nh√¨n g√¨ d·∫°? B·∫•m v√†o ƒë√¢y n√®~</button>
    
    <div class="memory-note">
      <i class="fas fa-heart" style="color: var(--accent); margin-right: 5px;"></i>
      L·∫ßn ƒë·∫ßu ch√∫ng ta g·∫∑p nhau...
    </div>
  </div>

  <!-- Screen 2 -->
  <div class="screen hidden" id="screen2">
    <p id="message">D√π th·∫ø n√†o ƒëi n·ªØa, em c≈©ng lu√¥n c·∫ßn ch·ªã!!!! üíû</p>
    
    <div class="countdown-container">
      <p>Ch√∫ng ta ƒë√£ b√™n nhau ƒë∆∞·ª£c:</p>
      <div class="countdown">
        <span id="years">0</span> nƒÉm 
        <span id="months">0</span> th√°ng 
        <span id="days">0</span> ng√†y
      </div>
    </div>
    
  <!-- Memory gallery -->
    <div class="memory-gallery">
      <div class="memory-item">
        <img src="images/memory2.png" alt="K·ª∑ ni·ªám 1" loading="eager" decoding="async">
      </div>
      <div class="memory-item">
        <img src="images/memory3.png" alt="K·ª∑ ni·ªám 2" loading="eager" decoding="async">
      </div>
      <div class="memory-item">
        <img src="images/memory4.png" alt="K·ª∑ ni·ªám 3" loading="eager" decoding="async">
      </div>
    </div>


    <button class="heart-button" onclick="goToScreen3()" aria-label="Xem th∆∞">C√≤n n·ªØa ƒë√≥ ü¶ä</button>
  </div>

  <!-- Screen 3: Love Letter -->
  <div class="screen hidden" id="screen3">
    <h1>Th∆∞ G·ª≠i B√≠ch Hi·ªÅn - Jade Aki üíå</h1>
    
    <div class="letter-wrapper">
      <div class="love-letter" id="loveLetter">
        <div class="letter-front">ƒê·ªçc th∆∞ ƒëi n√® üêº</div>
        <div class="letter-back">
          <div class="letter-content">
            <div id="typedText"></div>
          </div>
          <div class="letter-seal"></div>
        </div>
      </div>
    </div>
    
    <button class="heart-button" onclick="safeBackToScreen2()" aria-label="Quay l·∫°i">Quay l·∫°i</button>
  </div>

  <script>
    // ===== KHAI B√ÅO BI·∫æN TO√ÄN C·ª§C =====
    const audio = document.getElementById('audioElement');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const nowPlaying = document.getElementById('nowPlaying');
    const songArtist = document.getElementById('songArtist');
    const musicPlayer = document.getElementById('musicPlayer');
    const replayOneBtn = document.getElementById('replayOneBtn');
    const replayAllBtn = document.getElementById('replayAllBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    // const musicToggle = document.getElementById('music-toggle'); // Removed - element no longer exists
    
    let isPlaying = false;
    let isUserInteracted = false;
    let isReplayOne = false;
    let isReplayAll = true;
    let isShuffle = false;
    let originalPlaylist = [];
    let collapseTimeout;
    const COLLAPSE_DELAY = 5000;
    
    // ===== PH·∫¶N PLAYLIST =====
    // ===== PH·∫¶N PLAYLIST =====
    const songs = [
      { 
        title: "T√¨nh Y√™u Cu·ªìng Nhi·ªát M√πa H√®", 
        src: "assets/audio/TinhYeuCuongNhietMuaHe.mp3", 
        artist: "L·ª•c Ki·ªát awr" 
      },
      { 
        title: "G√µ ƒê√°ng Y√™u R·ªìi Nh·∫•n Ph√≠m 5", 
        src: "assets/audio/GoDangYeuRoiNhanPhim5.mp3", 
        artist: "" 
      },
      { 
        title: "Tƒ©nh L·∫∑ng", 
        src: "assets/audio/TinhLang.mp3", 
        artist: "ƒê·∫°i Huy·ªÖn" 
      },
      { 
        title: "Chia C·∫≠u M·ªôt N·ª≠a", 
        src: "assets/audio/ChiaCauMotNua.mp3", 
        artist: "Di·ªáp H·∫≠n Th·ªßy" 
      },
      { 
        title: "T√¨nh Y√™u C·ªßa Em Kh√¥ng C√≥ D·∫°o ƒê·∫ßu", 
        src: "assets/audio/TinhYeuCuaEmKhongCoKhucDaoDau.mp3", 
        artist: "Di·ªáp Hy Nguy√™n" 
      },
      { 
        title: "V·ªãnh TrƒÉng Khuy·∫øt", 
        src: "assets/audio/VinhTrangKhuyet.mp3", 
        artist: "ƒê·ª£i M·ªôt Ch√∫t V·ªÅ Nh√† Ngay" 
      },
      { 
        title: "D√†nh ƒêi·ªÅu T·ªët ƒê·∫πp Nh·∫•t Cho Em", 
        src: "assets/audio/DanhDieuTotDepNhatChoEm.mp3", 
        artist: "D∆∞ Giai V·∫≠n" 
      },
      { 
        title: "M∆∞a T√¨nh Y√™u", 
        src: "assets/audio/MuaTinhYeu.mp3", 
        artist: "D∆∞∆°ng Th·ª´a L√¢m" 
      },
      { 
        title: "Anh R·∫•t H·∫°nh Ph√∫c", 
        src: "assets/audio/AnhRatHanhPhuc.mp3", 
        artist: "Eric Chou" 
      },
      { 
        title: "X·ª©ng ƒê√¥i", 
        src: "assets/audio/XungDoi.mp3", 
        artist: "Giang H·∫°o Nam" 
      },
      { 
        title: "C·∫∑p ƒê√¥i ƒê·∫πp Nh·∫•t", 
        src: "assets/audio/CapDoiDepNhat.mp3", 
        artist: "H·∫Øc K·ª≥ T·ª≠" 
      },
      { 
        title: "K·∫πo B√¥ng G√≤n", 
        src: "assets/audio/KeoBongGon.mp3", 
        artist: "H·∫Øc K·ª≥ T·ª≠" 
      },
      { 
        title: "Ch√¨m ƒê·∫Øm", 
        src: "assets/audio/ChimDam.mp3", 
        artist: "Juggshots" 
      },
      { 
        title: "Ph√©p M√†u T√¨nh Y√™u", 
        src: "assets/audio/PhepMauTinhYeu.mp3", 
        artist: "Kim Sa"
      },
      { 
        title: "T·ª´ Kh√≥a", 
        src: "assets/audio/TuKhoa.mp3", 
        artist: "L√¢m Tu·∫•n Ki·ªát" 
      },
      { 
        title: "Th√°p R∆°i T·ª± Do", 
        src: "assets/audio/ThapRoiTuDo.mp3", 
        artist: "LBI L·ª£i B·ªâ" 
      },
      { 
        title: "Anh Mu·ªën Tr·ªü Th√†nh", 
        src: "assets/audio/AnhMuonTroThanh.mp3", 
        artist: "L·ª•c Ki·ªát awr" 
      },
      { 
        title: "Gi√≥ ƒê√™m G·∫∑p Em", 
        src: "assets/audio/GioDemGapEm.mp3", 
        artist: "L·ª•c Ki·ªát awr" 
      },
      { 
        title: "ƒê√™m V√† Ng√†y", 
        src: "assets/audio/DemVaNgay.mp3", 
        artist: "L∆∞u Ch√≠ Giai, ƒê√¥ Tr√≠ VƒÉn" 
      },
      { 
        title: "Minh Ch·ª©ng C·ªßa Nh·ªãp ƒê·∫≠p Tr√°i Tim", 
        src: "assets/audio/MinhChungCuaNhipDapTraiTim.mp3", 
        artist: "L∆∞u Nh√¢n Ng·ªØ" 
      },
      { 
        title: "M√πa H·∫°", 
        src: "assets/audio/MuaHa.mp3", 
        artist: "L√Ω C·ª≠u Tri·∫øt" 
      },
      { 
        title: "C·∫ßn M·ªôt", 
        src: "assets/audio/CanMot.mp3", 
        artist: "L√Ω Nhu·∫≠n K·ª≥" 
      },
      { 
        title: "Su·∫•t Hai Ng∆∞·ªùi T·ªët ƒê·∫πp", 
        src: "assets/audio/SuatHaiNguoiTotDep.mp3", 
        artist: "L√Ω Tu·∫•n Ngh·ªã" 
      },
      { 
        title: "√Åt Ch·ªß B√†i", 
        src: "assets/audio/AtChuBai.mp3", 
        artist: "Maxterp1ce, Tr√¢u B√°i B√°i" 
      },
      { 
        title: "Vui V·∫ª", 
        src: "assets/audio/VuiVe.mp3", 
        artist: "Nh·∫≠m Nhi√™n, Ti·ªÉu Lai Ca" 
      },
      { 
        title: "Ch·∫ßm Ch·∫≠m", 
        src: "assets/audio/ChamCham.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "C√≥ Ch√∫t", 
        src: "assets/audio/CoChut.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "C√¥ G√°i", 
        src: "assets/audio/CoGai.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "R·∫•t C·∫ßn", 
        src: "assets/audio/RatCan.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "R·∫•t Th√≠ch Em", 
        src: "assets/audio/RatThichEm.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "S·ªü Th√≠ch", 
        src: "assets/audio/SoThich.mp3", 
        artist: "Nhan Nh√¢n Trung" 
      },
      { 
        title: "B√≠ M·∫≠t C·ªßa Anh", 
        src: "assets/audio/BiMatCuaAnh.mp3", 
        artist: "Nhan Nh√¢n Trung, Echo" 
      },
      { 
        title: "Gi√≥ Th·ªïi Khi Nh·ªõ Anh", 
        src: "assets/audio/GioThoiKhiNhoAnh.mp3", 
        artist: "Thi·ªán Y Thu·∫ßn" 
      },
      { 
        title: "L·ªùi T·ªè T√¨nh C·ªßa Gi√≥ ƒê√™m", 
        src: "assets/audio/LoiToTinhCuaGioDem.mp3", 
        artist: "Tinh D√£" 
      },
      { 
        title: "Ng·ªçn Gi√≥ ƒê√™m Qua, √Ånh TrƒÉng ƒê√™m Nay", 
        src: "assets/audio/NgonGioDemQuaAnhTrangDemNay.mp3", 
        artist: "Trang K·ª≥ VƒÉn 29" 
      },
      { 
        title: "Y√™u L√† Kh·∫Øc L√£ng M·∫°n L√™n T·ª´ng Ph√∫t Gi√¢y", 
        src: "assets/audio/YeuLaKhacLangManLenTungPhutGiay.mp3", 
        artist: "Tr√¢u B√°i B√°i" 
      },
      { 
        title: "Hoang T∆∞·ªüng N·ªôi T√¢m", 
        src: "assets/audio/HoangTuongNoiTam.mp3", 
        artist: "Tr√¢u B√°i B√°i, Leggo" 
      },
      { 
        title: "ƒê·∫Øm Ch√¨m", 
        src: "assets/audio/DamChim.mp3", 
        artist: "Tr√¢u B√°i B√°i, Pank" 
      },
      { 
        title: "Em", 
        src: "assets/audio/Em.mp3", 
        artist: "Tr·ªãnh Nhu·∫≠n Tr·∫°ch" 
      },
      { 
        title: "Ngang Qua Nh√¢n Gian", 
        src: "assets/audio/NgangQuaNhanGian.mp3", 
        artist: "√öc Kh·∫£ Duy" 
      },
      { 
        title: "C√≥ Ch√∫t Ng·ªçt Ng√†o", 
        src: "assets/audio/CoChutNgotNgao.mp3", 
        artist: "U√¥ng T√¥ Lang" 
      },
      { 
        title: "Tr·ªùi H·ª≠ng N·∫Øng", 
        src: "assets/audio/TroiHungNang.mp3", 
        artist: "U√¥ng T√¥ Lang" 
      },
      { 
        title: "Chi·∫øc H·ªôp Th·ªùi Gian", 
        src: "assets/audio/ChiecHopThoiGian.mp3", 
        artist: "Vƒ©nh B√¢n Ryan.B, T√πng L√¢m ƒê·ªìng elf" 
      },
      { 
        title: "C∆∞ng Chi·ªÅu Che Ch·ªü", 
        src: "assets/audio/CungChieuCheCho.mp3", 
        artist: "V∆∞∆°ng L√Ω VƒÉn" 
      },
      { 
        title: "Nhi·ªát Luy·∫øn V·ªã Kem", 
        src: "assets/audio/NhietLuyenViKem.mp3", 
        artist: "yihuik Dƒ© Tu·ªá" 
      },
      { 
        title: "Tr√† ƒê·∫Øng", 
        src: "assets/audio/TraDang.mp3", 
        artist: "yihuik Dƒ© Tu·ªá; Aioz" 
      }
    ];

    
    let currentSongIndex = 0;
    
    // ===== H√ÄM X·ª¨ L√ù AUDIO =====
    function initAudio() {
      // Hi·ªÉn th·ªã player ngay t·ª´ ƒë·∫ßu
      musicPlayer.style.display = 'flex';
      
      // Ki·ªÉm tra playlist
      if (songs.length === 0) {
        nowPlaying.querySelector('span').textContent = "Kh√¥ng c√≥ b√†i h√°t";
        songArtist.querySelector('span').textContent = "";
        return;
      }
      
      // Sao ch√©p playlist g·ªëc
      originalPlaylist = [...songs];
      
      // Thi·∫øt l·∫≠p b√†i h√°t ƒë·∫ßu ti√™n
      audio.src = songs[currentSongIndex].src;
      updateNowPlaying();
      
      // S·ª± ki·ªán khi b√†i h√°t k·∫øt th√∫c
      audio.addEventListener('ended', handleSongEnded);
      
      // S·ª± ki·ªán play/pause
      playPauseBtn.addEventListener('click', togglePlayPause);
      
      // S·ª± ki·ªán chuy·ªÉn b√†i
      prevBtn.addEventListener('click', playPrevSong);
      nextBtn.addEventListener('click', playNextSong);
      
      // S·ª± ki·ªán cho c√°c n√∫t ch·ª©c nƒÉng
      replayOneBtn.addEventListener('click', toggleReplayOne);
      replayAllBtn.addEventListener('click', toggleReplayAll);
      shuffleBtn.addEventListener('click', toggleShuffle);
      
      // K√≠ch ho·∫°t ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh
      replayAllBtn.classList.add('active');
      
      // S·ª± ki·ªán ƒë·ªÉ reset timeout thu g·ªçn
      musicPlayer.addEventListener('mouseenter', resetCollapseTimeout);
      musicPlayer.addEventListener('touchstart', resetCollapseTimeout);
    }
    
    // C·∫≠p nh·∫≠t th√¥ng tin b√†i h√°t
    function updateNowPlaying() {
      const song = songs[currentSongIndex];
      
      if (nowPlaying) nowPlaying.querySelector('span').textContent = song.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ';
      if (songArtist) songArtist.querySelector('span').textContent = song.artist || '';
      
      // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ DOM c·∫≠p nh·∫≠t tr∆∞·ªõc khi ki·ªÉm tra
      setTimeout(() => {
      // Ki·ªÉm tra v√† √°p d·ª•ng hi·ªáu ·ª©ng ch·∫°y ch·ªØ n·∫øu c·∫ßn
      checkAndApplyMarquee(nowPlaying);
      checkAndApplyMarquee(songArtist);
      }, 100);
      
      console.log('ƒêang ph√°t:', song.title, '-', song.artist);
    }
    
    // Ki·ªÉm tra v√† √°p d·ª•ng hi·ªáu ·ª©ng ch·∫°y ch·ªØ
    function checkAndApplyMarquee(element) {
      if (!element) return;
      
      const span = element.querySelector('span');
      if (!span) return;
      
      // Reset t·∫•t c·∫£ classes v√† styles
      element.classList.remove('marquee', 'long-text');
      span.style.animation = 'none';
      span.style.transform = 'translateX(0)';
      span.style.paddingLeft = '0';
      
      // Force reflow
      void span.offsetWidth;
      
      // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ c·∫≠p nh·∫≠t
      setTimeout(() => {
        // Force layout calculation
        span.style.display = 'inline-block';
        span.style.width = 'auto';
        span.style.whiteSpace = 'nowrap';
      
      // Ki·ªÉm tra n·∫øu n·ªôi dung v∆∞·ª£t qu√° chi·ªÅu r·ªông
        const containerWidth = element.offsetWidth;
        const textWidth = span.scrollWidth;
        
        console.log('Container width:', containerWidth, 'Text width:', textWidth);
        
        if (textWidth > containerWidth && containerWidth > 0) {
          // S·ª≠ d·ª•ng CSS-only approach
          element.classList.add('long-text', 'marquee-active');
          console.log('Applied marquee classes for scrolling effect');
          
          // ƒê·∫£m b·∫£o animation ƒë∆∞·ª£c k√≠ch ho·∫°t
          span.style.animation = 'marquee2 6s linear infinite';
          
          // Th√™m event listener ƒë·ªÉ pause khi hover (ch·ªâ tr√™n desktop)
          if (window.matchMedia('(hover: hover)').matches) {
            element.addEventListener('mouseenter', () => {
              span.style.animationPlayState = 'paused';
            });
            element.addEventListener('mouseleave', () => {
              span.style.animationPlayState = 'running';
            });
          }
        }
      }, 200);
    }
    
    // X·ª≠ l√Ω khi b√†i h√°t k·∫øt th√∫c
    function handleSongEnded() {
      if (isReplayOne) {
        // L·∫∑p l·∫°i b√†i hi·ªán t·∫°i
        audio.currentTime = 0;
        audio.play();
      } else if (isShuffle) {
        // Ph√°t b√†i h√°t ng·∫´u nhi√™n ti·∫øp theo
        playRandomSong();
      } else {
        // Ph√°t b√†i ti·∫øp theo trong danh s√°ch
        playNextSong();
      }
    }
    
    // Ph√°t b√†i h√°t
    async function playSong() {
      try {
        // Ki·ªÉm tra xem audio c√≥ src kh√¥ng
        if (!audio.src) {
          console.log('No audio source');
          return;
        }
        
        await audio.play();
        isPlaying = true;
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        playPauseBtn.title = "T·∫°m d·ª´ng";
        updateNowPlaying();
        resetCollapseTimeout();
      } catch (err) {
        console.error("L·ªói ph√°t nh·∫°c:", err);
        // Ch·ªâ log l·ªói AbortError n·∫øu kh√¥ng ph·∫£i do user interaction
        if (err.name !== 'AbortError') {
        if (nowPlaying) nowPlaying.querySelector('span').textContent = "L·ªói khi ph√°t nh·∫°c";
        if (songArtist) songArtist.querySelector('span').textContent = "";
        }
      }
    }
    
    // T·∫°m d·ª´ng b√†i h√°t
    function pauseSong() {
      audio.pause();
      isPlaying = false;
      playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
      playPauseBtn.title = "Ph√°t";
      resetCollapseTimeout();
    }
    
    // Chuy·ªÉn b√†i ti·∫øp theo
    function playNextSong() {
      if (isShuffle) {
        playRandomSong();
        return;
      }
      
      currentSongIndex = (currentSongIndex + 1) % songs.length;
      audio.src = songs[currentSongIndex].src;
      updateNowPlaying();
      playSong();
    }
    
    // Chuy·ªÉn b√†i tr∆∞·ªõc
    function playPrevSong() {
      if (isShuffle) {
        playRandomSong();
        return;
      }
      
      currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
      audio.src = songs[currentSongIndex].src;
      updateNowPlaying();
      playSong();
    }
    
    // Ph√°t b√†i h√°t ng·∫´u nhi√™n
    function playRandomSong() {
      if (!songs || songs.length === 0) {
        console.log('No songs available');
        return;
      }
      
      let newIndex;
      do {
        newIndex = Math.floor(Math.random() * songs.length);
      } while (newIndex === currentSongIndex && songs.length > 1);
      
      currentSongIndex = newIndex;
      
      if (songs[currentSongIndex] && songs[currentSongIndex].src) {
      audio.src = songs[currentSongIndex].src;
      updateNowPlaying();
      playSong();
      } else {
        console.log('Invalid song at index:', currentSongIndex);
      }
    }
    
    // B·∫≠t/t·∫Øt ch·∫ø ƒë·ªô l·∫∑p l·∫°i m·ªôt b√†i
    function toggleReplayOne() {
      isReplayOne = true;
      isReplayAll = false;
      
      replayOneBtn.classList.add('active');
      replayAllBtn.classList.remove('active');
      
      // T·∫Øt shuffle n·∫øu ƒëang b·∫≠t
      if (isShuffle) {
        toggleShuffle();
      }
      
      resetCollapseTimeout();
    }
    
    // B·∫≠t/t·∫Øt ch·∫ø ƒë·ªô l·∫∑p l·∫°i t·∫•t c·∫£
    function toggleReplayAll() {
      isReplayOne = false;
      isReplayAll = true;
      
      replayOneBtn.classList.remove('active');
      replayAllBtn.classList.add('active');
      
      resetCollapseTimeout();
    }
    
    // B·∫≠t/t·∫Øt ch·∫ø ƒë·ªô ph√°t ng·∫´u nhi√™n
    function toggleShuffle() {
      isShuffle = !isShuffle;
      
      if (isShuffle) {
        shuffleBtn.classList.add('active');
        
        // T·∫°o playlist ng·∫´u nhi√™n nh∆∞ng gi·ªØ b√†i hi·ªán t·∫°i ·ªü ƒë·∫ßu
        const currentSong = songs[currentSongIndex];
        const shuffledSongs = [...songs]
          .filter((_, i) => i !== currentSongIndex)
          .sort(() => Math.random() - 0.5);
        
        // ƒê·∫∑t b√†i hi·ªán t·∫°i ·ªü ƒë·∫ßu playlist
        songs.length = 0;
        songs.push(currentSong, ...shuffledSongs);
      } else {
        shuffleBtn.classList.remove('active');
        
        // Kh√¥i ph·ª•c playlist g·ªëc
        songs.length = 0;
        songs.push(...originalPlaylist);
        
        // T√¨m l·∫°i v·ªã tr√≠ b√†i h√°t hi·ªán t·∫°i
        currentSongIndex = songs.findIndex(
          song => song.src === audio.src
        );
      }
      
      resetCollapseTimeout();
    }
    
    // Chuy·ªÉn ƒë·ªïi play/pause
    function togglePlayPause() {
      if (isPlaying) {
        pauseSong();
      } else {
        playSong();
      }
      isUserInteracted = true;
    }
    
    // Thu g·ªçn tr√¨nh ph√°t nh·∫°c
    function collapsePlayer() {
      musicPlayer.classList.add('collapsed');
    }
    
    // M·ªü r·ªông tr√¨nh ph√°t nh·∫°c
    function expandPlayer() {
      musicPlayer.classList.remove('collapsed');
    }
    
    // Reset timeout thu g·ªçn
    function resetCollapseTimeout() {
      clearTimeout(collapseTimeout);
      expandPlayer();
      
      // ƒê·∫∑t timeout m·ªõi ƒë·ªÉ thu g·ªçn sau 5 gi√¢y
      collapseTimeout = setTimeout(() => {
        if (isPlaying || !musicPlayer.classList.contains('collapsed')) {
          collapsePlayer();
        }
      }, COLLAPSE_DELAY);
    }
    
    // ===== PH·∫¶N UNLOCK AUTOPLAY =====
    // DOM elements
    const lockScreenEl = document.getElementById("lockScreen");
    const digit1 = document.getElementById("digit1");
    const digit2 = document.getElementById("digit2");
    const digit3 = document.getElementById("digit3");
    const digit4 = document.getElementById("digit4");
    const lockButtons = document.querySelectorAll(".lock-btn[data-number]");
    const clearBtn = document.getElementById("clearBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const submitCodeBtn = document.getElementById("submitCode");
    const starsContainer = document.getElementById("stars");
    // const darkModeToggle = document.getElementById("dark-mode-toggle"); // Removed - element no longer exists
    const heartsContainer = document.getElementById("hearts");
    const body = document.body;
    const gfPic = document.getElementById("girlfriend-pic");
    const screen1 = document.getElementById("screen1");
    const screen2 = document.getElementById("screen2");
    const screen3 = document.getElementById("screen3");
    const lockHeart = document.getElementById("lockHeart");
    const lockBody = document.getElementById("lockBody");
    const lockNotch = document.getElementById("lockNotch");
    const loveLetter = document.getElementById("loveLetter");
    const typedText = document.getElementById("typedText");
    
    let currentDigit = 0;
    let enteredCode = [];

    // Handle number buttons
    lockButtons.forEach(button => {
      button.addEventListener("click", () => {
        if (currentDigit < 4) {
          const number = button.dataset.number;
          enteredCode.push(number);
          
          switch(currentDigit) {
            case 0:
              digit1.textContent = number;
              break;
            case 1:
              digit2.textContent = number;
              break;
            case 2:
              digit3.textContent = number;
              break;
            case 3:
              digit4.textContent = number;
              break;
          }
          
          currentDigit++;
          
          if (currentDigit === 4) {
            checkCode();
          }
        }
      });
    });

    // Delete button
    deleteBtn.addEventListener("click", () => {
      if (currentDigit > 0) {
        enteredCode.pop();
        currentDigit--;
        
        switch(currentDigit) {
          case 0:
            digit1.textContent = "-";
            break;
          case 1:
            digit2.textContent = "-";
            break;
          case 2:
            digit3.textContent = "-";
            break;
          case 3:
            digit4.textContent = "-";
            break;
        }
      }
    });

    // Clear button
    clearBtn.addEventListener("click", () => {
      currentDigit = 0;
      enteredCode = [];
      digit1.textContent = "-";
      digit2.textContent = "-";
      digit3.textContent = "-";
      digit4.textContent = "-";
    });

    // Check passcode
    function checkCode() {
      const correctCode = ['1', '1', '0', '5'];
      const isCorrect = enteredCode.length === correctCode.length && 
                        enteredCode.every((val, index) => val === correctCode[index]);
      
      if (isCorrect) {
        // Unlock animation
        lockNotch.style.animation = "unlock 1s forwards";
        lockBody.style.animation = "unlockBody 1s forwards";
        lockNotch.classList.add("unlocked");
        lockBody.classList.add("unlocked");
        
        // Confetti effect
        createStars(50);
        confetti({
          particleCount: 200,
          spread: 100,
          origin: { y: 0.6 },
          colors: ['#f8b4d9', '#fce4ec', '#ffffff'],
        });
        
        // Hide lock screen
        setTimeout(() => {
          lockScreenEl.style.opacity = "0";
          setTimeout(() => {
            lockScreenEl.style.display = "none";
            screen1.classList.remove("hidden");
            screen1.classList.add("active");
            
            // Hi·ªÉn th·ªã player
            musicPlayer.style.display = 'flex';
            
            // Autoplay music sau khi m·ªü kh√≥a
            setTimeout(() => {
              if (audio && !isPlaying) {
                playRandomSong();
              }
            }, 1000);
            
            // B·∫Øt ƒë·∫ßu timeout thu g·ªçn
            resetCollapseTimeout();
          }, 500);
        }, 1500);
      } else {
        // Wrong code - shake effect
        const codeDisplay = document.getElementById("codeDisplay");
        codeDisplay.style.animation = "none";
        void codeDisplay.offsetWidth;
        codeDisplay.style.animation = "shake 0.5s";
        
        lockHeart.style.animation = "shake 0.5s";
        setTimeout(() => {
          lockHeart.style.animation = "none";
        }, 500);
        
        // Reset code
        setTimeout(() => {
          currentDigit = 0;
          enteredCode = [];
          digit1.textContent = "-";
          digit2.textContent = "-";
          digit3.textContent = "-";
          digit4.textContent = "-";
        }, 500);
      }
    }

    // Create stars effect
    function createStars(count) {
      for (let i = 0; i < count; i++) {
        const star = document.createElement("div");
        star.classList.add("star");
        
        const size = Math.random() * 5 + 2;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 5;
        const duration = Math.random() * 3 + 2;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${posX}%`;
        star.style.top = `${posY}%`;
        star.style.animation = `twinkle ${duration}s linear ${delay}s infinite`;
        
        starsContainer.appendChild(star);
      }
    }

    submitCodeBtn.addEventListener("click", checkCode);

    // GIF hover effect
    gfPic.addEventListener('mouseenter', function() {
      this.src = this.dataset.animated;
    });
    
    gfPic.addEventListener('mouseleave', function() {
      this.src = this.dataset.static;
    });
    
    // Anniversary counter
    function updateAnniversaryCount() {
      const anniversaryDate = new Date('2025-05-11');
      const today = new Date();
      
      let years = today.getFullYear() - anniversaryDate.getFullYear();
      let months = today.getMonth() - anniversaryDate.getMonth();
      let days = today.getDate() - anniversaryDate.getDate();
      
      if (days < 0) {
        months--;
        const lastDay = new Date(today.getFullYear(), today.getMonth(), 0).getDate();
        days += lastDay;
      }
      
      if (months < 0) {
        years--;
        months += 12;
      }
      
      document.getElementById('years').textContent = years;
      document.getElementById('months').textContent = months;
      document.getElementById('days').textContent = days;
    }

    // Create floating hearts
    function createHearts() {
      const colors = ['#f8b4d9', '#fce4ec', '#e91e63', '#f8b4d9', '#ff92a5'];
      const emojis = ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'ü§é', 'üñ§', 'ü§ç'];
      
      for (let i = 0; i < 30; i++) {
        const heart = document.createElement('div');
        heart.classList.add('heart');
        heart.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
        
        const posX = Math.random() * 100;
        const delay = Math.random() * 5;
        const duration = Math.random() * 5 + 5;
        const size = Math.random() * 20 + 10;
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        heart.style.left = `${posX}%`;
        heart.style.animation = `floatHeart ${duration}s linear ${delay}s infinite`;
        heart.style.fontSize = `${size}px`;
        heart.style.color = color;
        
        heartsContainer.appendChild(heart);
      }
    }
    
    // Toggle dark mode
    // darkModeToggle.addEventListener("click", () => {
    //   body.classList.toggle("dark-mode");
    //   darkModeToggle.innerHTML = body.classList.contains("dark-mode") ? 
    //     '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    // });
    
    // Toggle music
    // musicToggle.addEventListener("click", () => {
    //   if (audio.paused) {
    //     playSong();
    //     musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
    //   } else {
    //     pauseSong();
    //     musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
    //   }
    // });
    
    // Navigate to screen 2
    function goToScreen2() {
      document.getElementById('screen1').classList.remove('active');
      document.getElementById('screen1').classList.add('hidden');
      
      setTimeout(() => {
        document.getElementById('screen2').classList.remove('hidden');
        document.getElementById('screen2').classList.add('active');
        
        // Confetti effect
        confetti({
          particleCount: 200,
          spread: 100,
          origin: { y: 0.6 },
          colors: ['#f8b4d9', '#fce4ec', '#ffffff'],
        });
        
        // Update counter
        updateAnniversaryCount();
      }, 300);
    }
    
    // Navigate to screen 3 (love letter)
    function goToScreen3() {
      document.getElementById('screen2').classList.remove('active');
      document.getElementById('screen2').classList.add('hidden');
      
      setTimeout(() => {
        document.getElementById('screen3').classList.remove('hidden');
        document.getElementById('screen3').classList.add('active');
        
        // Confetti effect
        confetti({
          particleCount: 150,
          spread: 80,
          origin: { y: 0.3 },
          colors: ['#f8b4d9', '#fff', '#fce4ec'],
        });
      }, 300);
    }
    
    // Safe back to screen 2
    function safeBackToScreen2() {
      try {
        const screen3 = document.getElementById('screen3');
        const screen2 = document.getElementById('screen2');
        
        if (!screen3 || !screen2) {
          console.error('Screen elements not found');
          return;
        }
        
        screen3.classList.remove('active');
        screen3.classList.add('hidden');
      
      setTimeout(() => {
          screen2.classList.remove('hidden');
          screen2.classList.add('active');
      }, 300);
      } catch (error) {
        console.error('Error in safeBackToScreen2:', error);
      }
    }
    
    // Back to screen 2
    function backToScreen2() {
      safeBackToScreen2();
    }
    
    // Love letter interaction
    if (loveLetter && typedText) {
      const content = `G·ª≠i ƒë·∫øn B√≠ch Hi·ªÅn - d·ª£ iu c·ªßa em
(ÀµÀÉ ·óú ÀÇÀµ) C·∫£m ∆°n d·ª£ ƒë√£ tin t∆∞·ªüng, ƒë·∫øn v√† y√™u emü•∫ 
Em y√™u ch·ªã Hi·ªÅn nhi·ªÅu l·∫ØmmmmmmmmmüòΩ
D√π xa nhau, √≠t g·∫∑p ƒë∆∞·ª£c nhau, em v·∫´n lu√¥n l√† con c√°o c·ªßa ch·ªã, l√† ng∆∞·ªùi y√™u th∆∞∆°ng ch·ªã, l√† v·ª£ ch·ªãü´∂ 
ƒê·ª´ng lo v·ªÅ em nh√©, em v·∫´n th·∫ø, v·∫´n y√™u ch·ªã.
Hy v·ªçng ch√∫ng ta s·∫Ω n·∫Øm tay nhau c√πng ƒëi h·∫øt ch·∫∑ng ƒë∆∞·ªùng d√†i ph√≠a tr∆∞·ªõc.
Con c√°o - m√®o con c·ªßa ch·ªã l√∫c n√†o c≈©ng c·∫ßn ch·ªã h·∫øt √°!!!!
Ch·ªã ƒë√≤i xa em n·ªØa th√¨ em c·∫Øn ch·ªã ƒë√≥oooooooooo
Em y√™u ch·ªã. Em y√™u B√≠ch Hi·ªÅn.
„Éæ(‚âß ‚ñΩ ‚â¶)„ÇùCon c√°o c·ªßa ch·ªã - Ph∆∞∆°ng Tr√¢m`;
      
      let hasTyped = false;
      
      loveLetter.addEventListener("click", () => {
        loveLetter.classList.toggle("opened");
        
        if (!hasTyped) {
          // Start typing effect
          let i = 0;
          const typingEffect = setInterval(() => {
            if (i < content.length) {
              typedText.innerHTML += content.charAt(i) === '\n' ? '<br>' : content.charAt(i);
              i++;
              
              // Auto scroll to bottom
              typedText.parentElement.scrollTop = typedText.parentElement.scrollHeight;
            } else {
              clearInterval(typingEffect);
              // Confetti effect when finished
              confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.8 },
                colors: ['#f8b4d9', '#fff', '#fce4ec'],
              });
            }
          }, 30);
          
          hasTyped = true;
        }
      });
    }
    
    // Initialize effects
    createHearts();
    initAudio();
    
    // Make memory note draggable
    const memoryNote = document.querySelector('.memory-note');
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    memoryNote.onmousedown = dragMouseDown;
    
    function dragMouseDown(e) {
      e.preventDefault();
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      document.onmousemove = elementDrag;
    }
    
    function elementDrag(e) {
      e.preventDefault();
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      
      const top = (memoryNote.offsetTop - pos2);
      const left = (memoryNote.offsetLeft - pos1);
      
      if (top > 0 && top < window.innerHeight - 100 && 
          left > 0 && left < window.innerWidth - 200) {
        memoryNote.style.top = top + "px";
        memoryNote.style.left = left + "px";
      }
    }
    
    function closeDragElement() {
      document.onmouseup = null;
      document.onmousemove = null;
    }
    
    // Th√™m s·ª± ki·ªán resize ƒë·ªÉ c·∫≠p nh·∫≠t hi·ªáu ·ª©ng ch·∫°y ch·ªØ
    window.addEventListener('resize', function() {
      checkAndApplyMarquee(nowPlaying);
      checkAndApplyMarquee(songArtist);
    });
    
    // Test function ƒë·ªÉ debug
    function testMarquee() {
      console.log('Testing marquee effect...');
      if (nowPlaying) {
        const span = nowPlaying.querySelector('span');
        console.log('Now playing span:', span);
        console.log('Text content:', span ? span.textContent : 'No span');
        console.log('Container width:', nowPlaying.offsetWidth);
        console.log('Text width:', span ? span.scrollWidth : 'No span');
        
        // Force layout calculation
        if (span) {
          span.style.display = 'inline-block';
          span.style.width = 'auto';
          span.style.whiteSpace = 'nowrap';
          console.log('After force layout - Text width:', span.scrollWidth);
          
          // Test marquee effect
          if (span.scrollWidth > nowPlaying.offsetWidth) {
            console.log('Text is too long, applying marquee...');
            nowPlaying.classList.add('long-text');
            span.style.animation = 'marquee 8s linear infinite';
            console.log('Marquee applied!');
          }
        }
      }
      if (songArtist) {
        const span = songArtist.querySelector('span');
        console.log('Artist span:', span);
        console.log('Text content:', span ? span.textContent : 'No span');
        console.log('Container width:', songArtist.offsetWidth);
        console.log('Text width:', span ? span.scrollWidth : 'No span');
        
        // Force layout calculation
        if (span) {
          span.style.display = 'inline-block';
          span.style.width = 'auto';
          span.style.whiteSpace = 'nowrap';
          console.log('After force layout - Text width:', span.scrollWidth);
          
          // Test marquee effect
          if (span.scrollWidth > songArtist.offsetWidth) {
            console.log('Artist text is too long, applying marquee...');
            songArtist.classList.add('long-text');
            span.style.animation = 'marquee 8s linear infinite';
            console.log('Marquee applied!');
          }
        }
      }
    }
    
    // G·ªçi test function sau khi page load
    setTimeout(testMarquee, 1000);
    
    // Function ƒë·ªÉ force marquee effect
    function forceMarquee() {
      console.log('Forcing marquee effect...');
      
      if (nowPlaying) {
        const span = nowPlaying.querySelector('span');
        if (span) {
          nowPlaying.classList.add('long-text', 'marquee-active');
          span.style.animation = 'marquee2 6s linear infinite';
          span.style.display = 'inline-block';
          span.style.paddingLeft = '100%';
          span.style.whiteSpace = 'nowrap';
          console.log('Forced marquee for now playing');
        }
      }
      
      if (songArtist) {
        const span = songArtist.querySelector('span');
        if (span) {
          songArtist.classList.add('long-text', 'marquee-active');
          span.style.animation = 'marquee2 6s linear infinite';
          span.style.display = 'inline-block';
          span.style.paddingLeft = '100%';
          span.style.whiteSpace = 'nowrap';
          console.log('Forced marquee for song artist');
        }
      }
    }
    
    // Register service worker
    if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('SW registered: ', registration);
          })
          .catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
    
    // Th√™m n√∫t home v√†o controls
    const homeBtn = document.createElement('button');
    homeBtn.className = 'control-btn';
    homeBtn.innerHTML = '<i class="fas fa-home"></i>';
    homeBtn.title = 'V·ªÅ trang ƒë·∫ßu';
    homeBtn.setAttribute('aria-label', 'V·ªÅ trang ƒë·∫ßu');
    homeBtn.onclick = function() {
      // Confetti effect khi nh·∫•n home
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.3 },
        colors: ['#f8b4d9', '#fce4ec', '#ffffff'],
      });
      
      // ·∫®n t·∫•t c·∫£ screens
      const screens = document.querySelectorAll('.screen');
      screens.forEach(screen => {
        screen.classList.remove('active');
        screen.classList.add('hidden');
      });
      
      // Hi·ªÉn th·ªã screen1 (trang ƒë·∫ßu ti√™n)
      setTimeout(() => {
        const screen1 = document.getElementById('screen1');
        if (screen1) {
          screen1.classList.remove('hidden');
          screen1.classList.add('active');
          
          // Th√™m hi·ªáu ·ª©ng ƒë·∫∑c bi·ªát cho trang ƒë·∫ßu
          const girlfriendPic = document.getElementById('girlfriend-pic');
          if (girlfriendPic) {
            girlfriendPic.style.animation = 'pulse 1s ease-in-out';
            setTimeout(() => {
              girlfriendPic.style.animation = '';
            }, 1000);
          }
        }
      }, 300);
    };
    
    // Th√™m n√∫t debug (kh√¥ng c·∫ßn thi·∫øt trong layout cu·ªëi c√πng)
    // const debugBtn = document.createElement('button');
    // debugBtn.className = 'control-btn';
    // debugBtn.innerHTML = '<i class="fas fa-eye"></i>';
    // debugBtn.title = 'Debug buttons';
    // debugBtn.setAttribute('aria-label', 'Debug buttons');
    // debugBtn.onclick = debugButtons;
    
    // Th√™m n√∫t game 2048
    const gameBtn = document.createElement('button');
    gameBtn.className = 'control-btn';
    gameBtn.innerHTML = '<i class="fas fa-gamepad"></i>';
    gameBtn.title = 'Ch∆°i game 2048';
    gameBtn.setAttribute('aria-label', 'Ch∆°i game 2048');
    gameBtn.onclick = function() {
      // Hi·ªÉn th·ªã th√¥ng b√°o nh·ªè
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        z-index: 1000;
        animation: slideIn 0.5s ease-out;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      `;
      notification.textContent = 'üéÆ M·ªü game 2048...';
      document.body.appendChild(notification);
      
      // M·ªü game 2048 trong tab m·ªõi
      window.open('https://tracykmeou2048game.netlify.app/', '_blank');
      
      // Confetti effect khi m·ªü game
      confetti({
        particleCount: 80,
        spread: 60,
        origin: { y: 0.4 },
        colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'],
      });
      
      // X√≥a th√¥ng b√°o sau 3 gi√¢y
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    };
    
    // T·∫°o controls-right container
    const controlsRight = document.createElement('div');
    controlsRight.className = 'controls-right';
    document.body.appendChild(controlsRight);
    
    // Th√™m n√∫t home v√† game v√†o controls b√™n tr√°i
    document.querySelector('.controls').appendChild(homeBtn);
    document.querySelector('.controls').appendChild(gameBtn);
    
    // Th√™m n√∫t theme
    const themeBtn = document.createElement('button');
    themeBtn.className = 'control-btn';
    themeBtn.innerHTML = '<i class="fas fa-moon"></i>';
    themeBtn.title = 'Chuy·ªÉn ƒë·ªïi theme';
    themeBtn.setAttribute('aria-label', 'Chuy·ªÉn ƒë·ªïi theme');
    themeBtn.onclick = function() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      themeBtn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      themeBtn.title = isDark ? 'Chuy·ªÉn sang s√°ng' : 'Chuy·ªÉn sang t·ªëi';
      
      // Confetti effect
      confetti({
        particleCount: 50,
        spread: 40,
        origin: { y: 0.3 },
        colors: isDark ? ['#2c3e50', '#34495e', '#7f8c8d'] : ['#f1c40f', '#f39c12', '#e67e22'],
      });
    };
    
    // Th√™m n√∫t nh·∫°c
    const musicBtn = document.createElement('button');
    musicBtn.className = 'control-btn';
    musicBtn.innerHTML = '<i class="fas fa-music"></i>';
    musicBtn.title = 'B·∫≠t/t·∫Øt nh·∫°c';
    musicBtn.setAttribute('aria-label', 'B·∫≠t/t·∫Øt nh·∫°c');
    musicBtn.onclick = function() {
      const musicPlayer = document.querySelector('.music-player');
      if (musicPlayer) {
        const isVisible = musicPlayer.style.display !== 'none';
        musicPlayer.style.display = isVisible ? 'none' : 'flex';
        
        if (!isVisible) {
          // Auto play khi hi·ªÉn th·ªã
          if (audio && !isPlaying) {
            playRandomSong();
          }
        }
      }
      
      // Confetti effect
      confetti({
        particleCount: 60,
        spread: 50,
        origin: { y: 0.3 },
        colors: ['#e74c3c', '#f39c12', '#f1c40f'],
      });
    };
    
    // Th√™m t·∫•t c·∫£ n√∫t v√†o controls b√™n ph·∫£i
    document.querySelector('.controls-right').appendChild(themeBtn);
    document.querySelector('.controls-right').appendChild(musicBtn);
    
    // Debug function ƒë·ªÉ ki·ªÉm tra buttons
    function debugButtons() {
      console.log('Debugging buttons...');
      
      const buttons = document.querySelectorAll('button');
      console.log('Total buttons found:', buttons.length);
      
      // Ki·ªÉm tra controls
      const leftControls = document.querySelector('.controls');
      const rightControls = document.querySelector('.controls-right');
      console.log('Left controls buttons:', leftControls ? leftControls.children.length : 0);
      console.log('Right controls buttons:', rightControls ? rightControls.children.length : 0);
      
      buttons.forEach((btn, index) => {
        const rect = btn.getBoundingClientRect();
        const styles = window.getComputedStyle(btn);
        console.log(`Button ${index + 1}:`, {
          tagName: btn.tagName,
          className: btn.className,
          id: btn.id,
          title: btn.title,
          visible: rect.width > 0 && rect.height > 0,
          display: styles.display,
          visibility: styles.visibility,
          opacity: styles.opacity,
          zIndex: styles.zIndex,
          position: styles.position,
          top: rect.top,
          left: rect.left,
          width: rect.width,
          height: rect.height,
          textContent: btn.textContent.trim()
        });
      });
    }
    
    // G·ªçi debug function sau khi page load
    setTimeout(debugButtons, 2000);
    
    // Safe back to screen 2 function
    function safeBackToScreen2() {
      try {
        const screen3 = document.getElementById('screen3');
        const screen2 = document.getElementById('screen2');
        
        if (!screen3 || !screen2) {
          console.error('Screen elements not found');
          return;
        }
        
        screen3.classList.remove('active');
        screen3.classList.add('hidden');
        
        setTimeout(() => {
          screen2.classList.remove('hidden');
          screen2.classList.add('active');
        }, 300);
      } catch (error) {
        console.error('Error in safeBackToScreen2:', error);
      }
    }
    
    // Override the old backToScreen2 function
    window.backToScreen2 = safeBackToScreen2;
  </script>
</body>
</html>